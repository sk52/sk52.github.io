{"componentChunkName":"component---src-templates-blog-post-js","path":"/publishing-a-private-package-to-github/","result":{"data":{"site":{"siteMetadata":{"title":"Always learning"}},"markdownRemark":{"id":"d6f5ca23-b0a7-5993-b195-0bb5da62e64e","excerpt":"Working with packages is something that is almost unavoidable in the JavaScript ecosystem, but we typically find ourselves using other peoples packages as…","html":"<p>Working with packages is something that is almost unavoidable in the JavaScript ecosystem, but we typically find ourselves using other peoples packages as dependencies in our projects. If you’ve ever wondered how to publish a package of your own, then read on.</p>\n<h2>Prerequisites</h2>\n<ul>\n<li>A GitHub account</li>\n<li>An NPM account</li>\n<li>Basic NodeJS experience</li>\n<li><code class=\"language-text\">npm</code> installed</li>\n</ul>\n<h2>What</h2>\n<p>I’ll be building a simple package to demonstrate the process of building and publishing to GitHub.\nThe example I’ll use is a measurement unit converter, e.g. convert miles to kilometers and vice versa. The package will contain some handy functions to crunch the numbers.</p>\n<h2>How</h2>\n<h3>Creating the Project</h3>\n<p>We’ll use <a href=\"https://tsdx.io/\">tsdx</a> to create our package, it claims to be a zero-config CLI for developing TypeScript packages. Basically saving us the legwork of dealing with boilerplate config.</p>\n<p>To create a project:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx tsdx create unit-converter</code></pre></div>\n<p>Select the basic template when prompted.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> unit-converter</code></pre></div>\n<p>Now we’ll just add a couple of basic functions in <code class=\"language-text\">src/index.ts</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> const milesToKilometers <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>distance: number<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin class-name\">return</span> distance * <span class=\"token number\">1.609344</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token builtin class-name\">export</span> const kilometersToMiles <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>distance: number<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin class-name\">return</span> distance * <span class=\"token number\">0.62137119223733</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If we want, we can add some test coverage for these functions too.</p>\n<p>Next, we’ll want to create a GitHub repo and push our work. The repo can be public or private, it’s up to you.</p>\n<h3>Adding Some Config to Package.json</h3>\n<p>To ensure that we publish to the correct registry, in the <code class=\"language-text\">package.json</code> add the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  <span class=\"token string\">\"publishConfig\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"registry\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"https://npm.pkg.github.com/\"</span>\n  <span class=\"token punctuation\">}</span>,\n  <span class=\"token string\">\"repository\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"https://github.com/your-username/unit-converter\"</span>,</code></pre></div>\n<p>We’ll also want to update the name and description:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  <span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"@your-username/unit-converter\"</span>,\n  <span class=\"token string\">\"description\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"A package for converting units of measurement\"</span>,</code></pre></div>\n<p>Now commit this change and push to the GitHub repo again.</p>\n<h3>Creating an .npmrc File and GitHub Access Token</h3>\n<p>We now need to create a <code class=\"language-text\">.npmrc</code> file in the project root, and add the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">//npm.pkg.github.com/:_authToken<span class=\"token operator\">=</span><span class=\"token variable\">${GITHUB_ACCESS_TOKEN}</span>\n@your-username:registry<span class=\"token operator\">=</span>https://npm.pkg.github.com</code></pre></div>\n<p>This will specify the registry for any packages prefixed with <code class=\"language-text\">@your-username</code>, it also specifies the auth token to use, which we will set in the next step using a GitHub Access Token.</p>\n<p>Next, in GitHub we’ll need to create a new Personal Access Token (PAT), which can be done in Settings -> Developer settings.</p>\n<p>Copy the PAT and then in your terminal run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">GITHUB_ACCESS_TOKEN</span><span class=\"token operator\">=</span>paste-access-token-here</code></pre></div>\n<p>Next, we need to login to NPM:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> login</code></pre></div>\n<p>Enter your username, password, and email address when prompted.</p>\n<h3>Publishing the Package</h3>\n<p>Now, we should be ready to try and publish.</p>\n<p>Run <code class=\"language-text\">npm version patch</code> to bump our package version.</p>\n<p>And then to test our package publish:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> publish --dry-run</code></pre></div>\n<p>This will do everything except actually pushing the package to the registry. If there are no errors, we can go ahead and run it for real.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> publish</code></pre></div>\n<p>And that’s it! If successful then the package should be visible from the GitHub repo on the right-hand-side under the “Packages” heading. It may take a few minutes to appear the first time, so be patient.</p>\n<h2>Summary</h2>\n<p>As we’ve seen, the process of publishing your first package is less daunting than it may seem. Publishing packages is a great way to start reusing utility code across your projects, or even sharing it publicly when you’re ready to.</p>","frontmatter":{"title":"Publishing a Private Package to GitHub","date":"August 24, 2021","description":null}},"previous":{"fields":{"slug":"/deploy-a-monorepo-to-heroku/"},"frontmatter":{"title":"Deploying a Monorepo to Heroku"}},"next":{"fields":{"slug":"/using-console.time/"},"frontmatter":{"title":"Using console.time and console.timeEnd in JavaScript"}}},"pageContext":{"id":"d6f5ca23-b0a7-5993-b195-0bb5da62e64e","previousPostId":"b6e6e2b4-ba32-51f2-b0f5-1559bbafd766","nextPostId":"6380ed5e-b420-5b92-a266-b289e5c4689d"}},"staticQueryHashes":["230163734","2841359383"]}